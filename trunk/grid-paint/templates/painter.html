{% extends "base.html" %}

{% block content %}  

<div class="row-fluid">
	<div class="span2">
		<div style="background-color:red">
			<ul>
				<li>Menu item 1</li>
				<li>Menu item 2</li>
			</ul>
		</div>
		<div id="shapes"></div>
		<div id="coordinates"></div>
		<div id="test"></div>
	</div>
	
	<div class="span10">
		<div id="canvas-wrapper" class="painter-canvas-wrapper">
			<div id="canvas"></div>			
		</div>
		
	</div>
</div>

<script src="/js/grids.js"></script>

<script>
var paper;
var grid;
var selectedShapeName=null;
//var paperShapes;

//var gridShapes;
//var toolbarShapes=[];


// 
function adjustCanvasWrapper() {
	$("#canvas-wrapper").height($(window).height()-50);
}

function paintShapeToolButton(shapeName) {
	var shape;
	for (var i=0; i<grid.shapes.length; i++) {
		if (grid.shapes[i].name==shapeName) {
			shape=grid.shapes[i];
			break;
		}
	}
	
	$("#shape-"+shapeName).html("");

	var shapeRect=grid.getShapeRect();
	var shapePoint=grid.centerPointToBasePoint(shapeRect.w / 2+10, shapeRect.h / 2+10);	
	var shapePaper=new Raphael("shape-"+shapeName, shapeRect.w+20, shapeRect.h+20);
	
	if (shapeName==selectedShapeName) {
		var bgElement=shapePaper.rect(0,0,paper.width,paper.height);
		bgElement.attr({"fill":"#cceeff", "stroke-width":0});
	}
	grid.shapes[i].paint(shapePaper, shapePoint, "#3377ee");
}

function createShapesToolbar() {
	var shapeElements="";
	for (var i=0; i<grid.shapes.length; i++) {
		shapeElements+='<span id="shape-'+grid.shapes[i].name+
			'" class="grid-shape-button" shape-name="'+
			grid.shapes[i].name+'"></span>';
	}
	
	$("#shapes").html(shapeElements);
	
	for (var i=0; i<grid.shapes.length; i++) {
		if (i==0) {
			selectedShapeName=grid.shapes[i].name;
		}
		paintShapeToolButton(grid.shapes[i].name);
	}
	
	$(".grid-shape-button").click(
		function() {
			var oldSelectedShapeName=selectedShapeName;
			selectedShapeName=$(this).attr("shape-name");
			for (var i=0; i<grid.shapes.length; i++) {
				if (grid.shapes[i].name==selectedShapeName ||
					grid.shapes[i].name==oldSelectedShapeName) {
					paintShapeToolButton(grid.shapes[i].name);		
				}
			}
		}
	)
}


$(function() {
	adjustCanvasWrapper();
	$(window).resize(
		function() {
			adjustCanvasWrapper();
		})
			
	paper=new Raphael("canvas",2000,2000);
	grid=new {{ grid }}();
	grid.paintGrid(paper);
	createShapesToolbar();
	
	$("#canvas").mousemove(
		function(event) {
			var cell=grid.pointToCell(event.offsetX,event.offsetY);
			$("#coordinates").text(cell.col+" "+cell.row);
		}
	)
})
</script>

{% endblock %}
